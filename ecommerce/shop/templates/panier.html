{% extends 'base.html' %}


{% block content %}
<div class="container mt-4">
    <h2>Votre panier</h2>
    <div class="row">
        <div class="col-md-12">
            <ul class="list-group" id="item-list"></ul>
        </div>
        <div class="mt-4">
            <h5>Total des articles : <span id="total-articles">0</span></h5>
            <h5>Prix total : <span id="total-price">0.00</span> € </h5>
        </div>
    </div>


{% endblock %} 

{% block js %} 

    <script type="text/javascript">

        // Vérifier si le panier existe dans le localStorage
        if (localStorage.getItem('panier')==null){
            var panier = {};
        }else{
            panier = JSON.parse(localStorage.getItem('panier'));
        }

        let totalArticles = 0;
        let totalPrix = 0;


         // Parcourir chaque élément du panier pour les afficher
        for (let key in panier) {
            if (panier.hasOwnProperty(key)) {
                let item = panier[key];
                let nom = item.name;
                let quantite = item.quantity;
                let formule = item.formule;
                let prixFormule = parseFloat(formule.split(' - ')[1].replace('€', '').trim());  // Extraire le prix de la formule
                
                // Vérifier si le prix est valide
                if (!isNaN(prixFormule)) {
                    // Ajouter à la liste des articles
                    let itemsString = `
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            ${nom} - ${formule}
                            <span class="badge badge-primary badge-pill">${quantite}</span>
                        </li>
                    `;
                    $('#item-list').append(itemsString);

                    // Calculer les totaux
                    totalArticles += quantite;
                    totalPrix += prixFormule * quantite;
                } else {
                    console.error(`Le prix pour l'article ${nom} est invalide : ${formule}`);
                }
            }
        }

        // Mettre à jour les totaux dans la page
        document.getElementById('total-articles').textContent = totalArticles;
        document.getElementById('total-price').textContent = totalPrix.toFixed(2);

    
    </script>

{% endblock%}
