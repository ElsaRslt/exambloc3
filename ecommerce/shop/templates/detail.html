{% extends 'base.html' %} <!-- permet d'avoir l'entête et le menu sur toutes les pages -->

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-6">
            <img src="{{ evenement_object.image.url }}" width="500px" height="500px" alt="{{ evenement_object.title }}" class="img-fluid">
        </div>
        <div class="col-md-6">
            <h2 class="text-warning">{{ evenement_object.title }}</h2>
            <p>{{ evenement_object.description }}</p>
            <form method="post">
                {% csrf_token %}
                <label for="formule">Choisir une formule:</label>
                <select name="formule" id="formule-select">
                    {% for formule in formules_with_prices %}
                        <option value="{{ formule.id }}" data-price-multiplier="{{ formule.price }}">{{ formule.formule }} - {{ formule.price|floatformat:2 }} €</option>
                    {% endfor %}
                </select>
                <p id="event-price">{{ formules_with_prices.0.price|floatformat:2 }} €</p>
                <button id="add-to-cart-btn" type="submit" class="btn btn-success shopping_cart" data-item-id="{{ evenement_object.id }}">Ajouter au panier</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block js %}
    <script type= "text/javascript">

        console.log("tester");
        // pour calculer le prix en fonction de la formule choisie 
        document.getElementById('formule-select').addEventListener('change', function() {
            var selectedOption = this.options[this.selectedIndex];
            var price = parseFloat(selectedOption.getAttribute('data-price-multiplier'));
            document.getElementById('event-price').textContent = price.toFixed(2) + ' €';
        });

        //on regarde si le panier est nul. si c'est le cas création d'un panier
        if(localStorage.getItem('panier')==null){
            var panier ={};
        // si c'est pas le cas on ajoute     
        }else{
            panier = JSON.parse(localStorage.getItem('panier'));
        }

        // Fonction pour calculer le nombre total d'articles dans le panier
        const calculerNombreTotalArticles = (panier) => {
            let total = 0;
            for (let key in panier) {
                total += panier[key];
            }
            return total;
        }

        // Ajouter un écouteur d'événement pour le bouton Ajouter au panier
        document.getElementById('add-to-cart-btn').addEventListener('click', function(event) {
            event.preventDefault(); // pour ne pas recharger la page et voir le degug en console
            console.log("ajouter");
            var item_id = this.getAttribute('data-item-id');
            console.log(item_id);
            if (panier[item_id] != undefined ){ 
                panier[item_id]=panier[item_id]+1; // s'il y a deja un article avec cet id dans le panier on rajoute 1
            }else{
                panier[item_id]=1; //quand on clic pour la premiere fois on ajoute 1 
            };
            console.log(panier);

            localStorage.setItem('panier',JSON.stringify(panier));// Récupération du panier depuis localStorage au chargement de la page

            // Pour afficher dans le panier dans la navbar le nombre total d'articles ajoutés au panier 
            let totalArticles = calculerNombreTotalArticles(panier);

            // pour afficher dans le panier dans la navbar le nombre d'evenement rajouter au panier 
            document.getElementById("shopping").innerHTML = "Panier(" + totalArticles + ")";

            
        });

        // Mettre à jour le panier lors du chargement de la page
        document.addEventListener('DOMContentLoaded', function() {
            let panier = JSON.parse(localStorage.getItem('panier')) || {};
            let totalArticles = calculerNombreTotalArticles(panier);
            document.getElementById("shopping").innerHTML = "Panier(" + totalArticles + ")";
        });

    </script>

{% endblock %}                                                                                  